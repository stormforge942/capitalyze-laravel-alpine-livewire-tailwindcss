<?php

namespace App\Http\Livewire;

use App\Models\Navbar;
use Livewire\Component;
use Illuminate\Support\Str;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class CompanyNavbar extends Component
{
    public $company;
    public $period = "annual";
    public $currentRoute;
    public $navbarItems;

    protected $queryString = [
        'period' => ['except' => 'annual']
    ];

    protected $listeners = ['periodChange' => '$refresh'];

    public function changePeriod($period)
    {
        $this->period = $period;
        return redirect()->route($this->currentRoute, ['ticker' => $this->company->ticker, 'period' => $period]);
    }

    public function render()
    {
        return view('livewire.company-navbar');
    }

    public function mount(Request $request)
    {
        if (!$this->currentRoute) {
            $this->currentRoute = $request->route()->getName();
        }

        $this->navbarItems = $this->navbar();
    }

    public function navbar()
    {
        return [
            [
                'title' => 'Overview',
                'icon' => <<<ICON
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8.66667 14V7.33333H14V14H8.66667ZM2 8.66667V2H7.33333V8.66667H2ZM6 7.33333V3.33333H3.33333V7.33333H6ZM2 14V10H7.33333V14H2ZM3.33333 12.6667H6V11.3333H3.33333V12.6667ZM10 12.6667H12.6667V8.66667H10V12.6667ZM8.66667 2H14V6H8.66667V2ZM10 3.33333V4.66667H12.6667V3.33333H10Z" fill="#464E49"/>
                </svg>
                ICON,
                'url' => route('company.profile', ['ticker' => $this->company->ticker]),
                'active' => request()->routeIs('company.profile')
            ],
            [
                'title' => 'Financials',
                'icon' => <<<ICON
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <g clip-path="url(#clip0_1063_41220)">
                    <path d="M2.70265 11.676H0.445165C0.200192 11.676 0 11.8735 0 12.1212V15.5535C0 15.7985 0.197543 15.9987 0.445165 15.9987H2.70265C2.94763 15.9987 3.14782 15.8011 3.14782 15.5535V12.1212C3.14786 11.8735 2.95028 11.676 2.70265 11.676ZM0.890372 15.1083V12.5637H2.25753V15.1083H0.890372Z" fill="#464E49"/>
                    <path d="M6.99172 8.32031H4.73423C4.48925 8.32031 4.28906 8.51786 4.28906 8.76548V15.5538C4.28906 15.7987 4.48661 15.9989 4.73423 15.9989H6.99172C7.23669 15.9989 7.43688 15.8013 7.43688 15.5538V8.76283C7.43688 8.51786 7.23934 8.32031 6.99172 8.32031ZM5.18204 15.1086V9.20804H6.5492V15.1086H5.18204Z" fill="#464E49"/>
                    <path d="M11.273 4.96484H9.01548C8.7705 4.96484 8.57031 5.16239 8.57031 5.41001V15.5542C8.57031 15.7992 8.7679 15.9994 9.01548 15.9994H11.273C11.5179 15.9994 11.7181 15.8019 11.7181 15.5542V5.4074C11.7155 5.16243 11.5179 4.96484 11.273 4.96484ZM10.8278 15.1091H9.46068V5.85257H10.8278V15.1091Z" fill="#464E49"/>
                    <path d="M15.5542 1.60156H13.2967C13.0518 1.60156 12.8516 1.79911 12.8516 2.04673V15.5469C12.8516 15.7918 13.0491 15.992 13.2967 15.992H15.5542C15.7992 15.992 15.9994 15.7945 15.9994 15.5469V2.04938C15.9968 1.8044 15.7992 1.60156 15.5542 1.60156ZM15.1091 15.107H13.7419V2.49458H15.1091V15.107Z" fill="#464E49"/>
                    <path d="M9.09911 0H6.77578C6.53081 0 6.33061 0.197584 6.33061 0.445165C6.33061 0.692787 6.5282 0.890331 6.77578 0.890331H8.02701L0.185089 8.72703C0.0112202 8.9009 0.0112202 9.18011 0.185089 9.35662C0.343149 9.51203 0.696103 9.47516 0.814678 9.35662L8.65395 1.51731V2.76854C8.65395 3.01351 8.85149 3.21371 9.09911 3.21371C9.34409 3.21371 9.54428 3.01616 9.54428 2.76854V0.445206C9.54428 0.200192 9.34674 0 9.09911 0Z" fill="#464E49"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_1063_41220">
                        <rect width="16" height="16" fill="white"/>
                    </clipPath>
                    </defs>
                </svg>
                ICON,
                'url' => route('company.report', ['ticker' => $this->company->ticker]),
                'active' => request()->routeIs('company.report')
            ],
            [
                'title' => 'Analysis',
                'icon' => <<<ICON
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M14.6693 3.66797C14.6693 3.11569 14.2216 2.66797 13.6693 2.66797H2.33594C1.78365 2.66797 1.33594 3.11569 1.33594 3.66797V6.66797H14.6693V3.66797Z" stroke="#464E49" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M1.375 13.0113L5.43353 8.91107L7.62663 11.0113L10.3077 8.66797L11.8012 10.124" stroke="#464E49" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14.6667 6V12.3333C14.6667 12.8856 14.219 13.3333 13.6667 13.3333H4" stroke="#464E49" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M6.375 4.66797H12.375" stroke="#464E49" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3.70312 4.66797H4.36979" stroke="#464E49" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M1.33594 6V9" stroke="#464E49" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ICON,
                'url' => route('company.profile', ['ticker' => $this->company->ticker]),
                'active' => request()->routeIs('company.analysis')
            ],
            [
                'title' => 'Filings',
                'icon' => <<<ICON
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8.66667 14.0007V15.6673L6.66667 14.334L4.66667 15.6673V14.0007H4.33333C3.04467 14.0007 2 12.956 2 11.6673V3.33398C2 2.22942 2.89543 1.33398 4 1.33398H13.3333C13.7015 1.33398 14 1.63246 14 2.00065V13.334C14 13.7022 13.7015 14.0007 13.3333 14.0007H8.66667ZM8.66667 12.6673H12.6667V10.6673H4.33333C3.78105 10.6673 3.33333 11.1151 3.33333 11.6673C3.33333 12.2196 3.78105 12.6673 4.33333 12.6673H4.66667V11.334H8.66667V12.6673ZM12.6667 9.33398V2.66732H4V9.35758C4.10887 9.34205 4.22016 9.33398 4.33333 9.33398H12.6667ZM4.66667 3.33398H6V4.66732H4.66667V3.33398ZM4.66667 5.33398H6V6.66732H4.66667V5.33398ZM4.66667 7.33398H6V8.66732H4.66667V7.33398Z" fill="#464E49"/>
                </svg>
                ICON,
                'url' => route('company.profile', ['ticker' => $this->company->ticker]),
                'active' => request()->routeIs('company.filings')
            ],
            [
                'title' => 'Ownership',
                'icon' => <<<ICON
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8.48437 4.56677V4.56687C8.48437 5.71152 7.35208 6.60669 6.00042 6.60687C6.00028 6.60687 6.00014 6.60687 6 6.60687V6.50687C5.52948 6.51081 5.06644 6.3936 4.65516 6.1673L8.48437 4.56677ZM8.48437 4.56677C8.48427 4.46636 8.47526 4.36625 8.45752 4.26761C9.28958 4.38271 10.061 4.77239 10.6481 5.37685C11.2464 5.99279 11.6161 6.79356 11.6979 7.64648C11.0321 7.76165 10.071 8.12396 9.76837 9.16359C9.63622 9.6171 9.31042 9.78918 8.91487 9.9981C8.83932 10.038 8.76123 10.0793 8.68146 10.1241C8.43849 10.2605 8.18962 10.4284 7.98554 10.6966C7.79375 10.9487 7.64621 11.2831 7.57341 11.7511C6.66084 11.6588 5.8118 11.2372 5.18635 10.5634C4.53965 9.86673 4.1796 8.95168 4.17812 8.00109C4.1773 7.39239 4.32491 6.7932 4.60748 6.2552L8.48437 4.56677ZM7.94625 3.47031C5.44789 3.47031 3.41562 5.50291 3.41562 8.00125C3.41562 10.4996 5.44789 12.5322 7.94625 12.5322C10.4446 12.5322 12.4772 10.4996 12.4772 8.00125C12.4772 5.5029 10.4449 3.47031 7.94625 3.47031Z" fill="#464E49" stroke="#464E49" stroke-width="0.2"/>
                    <path d="M12.7737 12.6283L12.9726 12.8228L12.9727 12.8229L12.9028 12.8944L12.7737 12.6283ZM12.7737 12.6283C13.6349 11.7217 14.2252 10.5912 14.4764 9.36488C14.7344 8.10591 14.6241 6.79926 14.1588 5.60131L14.1588 5.60126C12.8232 2.16853 8.94364 0.462421 5.51061 1.79839L5.41742 1.83465L5.45368 1.92785L5.65775 2.45222L5.69401 2.5454L5.78719 2.50915C8.82946 1.32574 12.2649 2.8368 13.4483 5.87778C13.8605 6.93937 13.958 8.09728 13.7291 9.21285C13.5069 10.2958 12.9862 11.2944 12.2268 12.096L11.8989 11.7766L11.8988 11.7765L11.8291 11.8481M12.7737 12.6283L11.3244 12.065C11.3236 12.0062 11.3402 11.9485 11.3722 11.8991C11.4042 11.8498 11.4502 11.811 11.5042 11.7878C11.5582 11.7646 11.618 11.7579 11.6758 11.7687C11.7336 11.7794 11.787 11.8071 11.8291 11.8481M11.8291 11.8481L12.2291 12.2378L11.8291 11.8481Z" fill="#464E49" stroke="#464E49" stroke-width="0.2"/>
                    <path d="M5.7268 13.3776L5.72718 13.3778C6.43753 13.6931 7.20338 13.8644 7.98039 13.8818C8.7574 13.8993 9.53015 13.7624 10.2539 13.4792L10.3472 13.4426L10.3836 13.5361L10.5873 14.0601L10.6235 14.1532L10.5305 14.1895C9.10687 14.745 7.53585 14.7956 6.0795 14.3327C4.62316 13.8698 3.36956 12.9216 2.52788 11.6462C1.6862 10.3707 1.30733 8.84523 1.45449 7.3242C1.59842 5.8365 2.23706 4.44108 3.26671 3.36033L3.02179 3.1217C2.96476 3.06698 2.92535 2.99648 2.90861 2.91924C2.89184 2.84183 2.89858 2.76117 2.92799 2.68763C2.9574 2.61409 3.00812 2.55102 3.07365 2.50652C3.13904 2.46212 3.21618 2.43823 3.29522 2.43792M5.7268 13.3776L3.29598 2.53792M5.7268 13.3776C4.85019 12.9928 4.08011 12.4009 3.48271 11.6529C2.88531 10.9048 2.47846 10.0229 2.29711 9.08285C2.11576 8.14284 2.16533 7.17285 2.44156 6.25623C2.70823 5.37135 3.17843 4.56174 3.81394 3.892L5.7268 13.3776ZM3.29522 2.43792C3.29538 2.43792 3.29554 2.43792 3.2957 2.43792L3.29598 2.53792M3.29522 2.43792L3.2948 2.43793L3.29598 2.53792M3.29522 2.43792L4.35366 2.42543L4.35504 2.52542M3.29598 2.53792L4.35504 2.52542M4.35504 2.52542L4.35386 2.42543L4.35377 2.42543M4.35504 2.52542L4.35377 2.42543M4.35377 2.42543C4.40584 2.42472 4.45755 2.43428 4.50593 2.45357C4.55435 2.47286 4.59849 2.50151 4.63582 2.53787C4.67316 2.57424 4.70296 2.61761 4.72352 2.6655C4.74407 2.71336 4.75499 2.7648 4.75566 2.81689L4.75565 2.81681L4.65566 2.81823L4.75566 2.81698L4.35377 2.42543ZM4.09623 4.16583L4.09635 4.16595L4.16598 4.09417L4.09615 4.16575C4.09617 4.16577 4.0962 4.1658 4.09623 4.16583Z" fill="#464E49" stroke="#464E49" stroke-width="0.2"/>
                </svg>
                ICON,
                'url' => route('company.ownership', ['ticker' => $this->company->ticker, 'history' => false]),
                'active' => request()->routeIs('company.ownership', 'company.fund')
            ],
            [
                'title' => 'Settings',
                'icon' => <<<ICON
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <g clip-path="url(#clip0_1063_41212)">
                    <path d="M5.79157 2.66737L7.52933 0.92964C7.78967 0.669287 8.21173 0.669287 8.47213 0.92964L10.2099 2.66737H12.6674C13.0355 2.66737 13.3341 2.96585 13.3341 3.33404V5.79157L15.0718 7.52932C15.3321 7.78965 15.3321 8.21179 15.0718 8.47212L13.3341 10.2099V12.6674C13.3341 13.0356 13.0355 13.3341 12.6674 13.3341H10.2099L8.47213 15.0718C8.21173 15.3321 7.78967 15.3321 7.52933 15.0718L5.79157 13.3341H3.33404C2.96585 13.3341 2.66737 13.0356 2.66737 12.6674V10.2099L0.92964 8.47212C0.669287 8.21179 0.669287 7.78965 0.92964 7.52932L2.66737 5.79157V3.33404C2.66737 2.96585 2.96585 2.66737 3.33404 2.66737H5.79157ZM4.00071 4.00071V6.34385L2.34385 8.00072L4.00071 9.65759V12.0007H6.34385L8.00073 13.6576L9.65753 12.0007H12.0007V9.65759L13.6575 8.00072L12.0007 6.34385V4.00071H9.65753L8.00073 2.34385L6.34385 4.00071H4.00071ZM8.00073 10.6674C6.52795 10.6674 5.33404 9.47345 5.33404 8.00072C5.33404 6.52795 6.52795 5.33404 8.00073 5.33404C9.47347 5.33404 10.6674 6.52795 10.6674 8.00072C10.6674 9.47345 9.47347 10.6674 8.00073 10.6674ZM8.00073 9.33405C8.73707 9.33405 9.33407 8.73712 9.33407 8.00072C9.33407 7.26432 8.73707 6.66739 8.00073 6.66739C7.26433 6.66739 6.6674 7.26432 6.6674 8.00072C6.6674 8.73712 7.26433 9.33405 8.00073 9.33405Z" fill="#464E49"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_1063_41212">
                        <rect width="16" height="16" fill="white"/>
                    </clipPath>
                    </defs>
                </svg>
                ICON,
                'url' => route('company.ownership', ['ticker' => $this->company->ticker]),
                'active' => request()->routeIs('company.settings')
            ],
            [
                'title' => 'More',
                'icon' => <<<ICON
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M11.3359 11.9982C11.3359 12.3664 11.6344 12.6649 12.0026 12.6649C12.3708 12.6649 12.6693 12.3664 12.6693 11.9982C12.6693 11.63 12.3708 11.3315 12.0026 11.3315C11.6344 11.3315 11.3359 11.63 11.3359 11.9982Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7.33594 11.9982C7.33594 12.3664 7.6344 12.6649 8.0026 12.6649C8.3708 12.6649 8.66927 12.3664 8.66927 11.9982C8.66927 11.63 8.3708 11.3315 8.0026 11.3315C7.6344 11.3315 7.33594 11.63 7.33594 11.9982Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3.33594 11.9982C3.33594 12.3664 3.63442 12.6649 4.0026 12.6649C4.37079 12.6649 4.66927 12.3664 4.66927 11.9982C4.66927 11.63 4.37079 11.3315 4.0026 11.3315C3.63442 11.3315 3.33594 11.63 3.33594 11.9982Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M11.3359 7.99821C11.3359 8.36641 11.6344 8.66488 12.0026 8.66488C12.3708 8.66488 12.6693 8.36641 12.6693 7.99821C12.6693 7.63001 12.3708 7.33154 12.0026 7.33154C11.6344 7.33154 11.3359 7.63001 11.3359 7.99821Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7.33594 7.99821C7.33594 8.36641 7.6344 8.66488 8.0026 8.66488C8.3708 8.66488 8.66927 8.36641 8.66927 7.99821C8.66927 7.63001 8.3708 7.33154 8.0026 7.33154C7.6344 7.33154 7.33594 7.63001 7.33594 7.99821Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3.33594 7.99821C3.33594 8.36641 3.63442 8.66488 4.0026 8.66488C4.37079 8.66488 4.66927 8.36641 4.66927 7.99821C4.66927 7.63001 4.37079 7.33154 4.0026 7.33154C3.63442 7.33154 3.33594 7.63001 3.33594 7.99821Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M11.3359 3.99821C11.3359 4.3664 11.6344 4.66488 12.0026 4.66488C12.3708 4.66488 12.6693 4.3664 12.6693 3.99821C12.6693 3.63002 12.3708 3.33154 12.0026 3.33154C11.6344 3.33154 11.3359 3.63002 11.3359 3.99821Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7.33594 3.99821C7.33594 4.3664 7.6344 4.66488 8.0026 4.66488C8.3708 4.66488 8.66927 4.3664 8.66927 3.99821C8.66927 3.63002 8.3708 3.33154 8.0026 3.33154C7.6344 3.33154 7.33594 3.63002 7.33594 3.99821Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3.33594 3.99821C3.33594 4.3664 3.63442 4.66488 4.0026 4.66488C4.37079 4.66488 4.66927 4.3664 4.66927 3.99821C4.66927 3.63002 4.37079 3.33154 4.0026 3.33154C3.63442 3.33154 3.33594 3.63002 3.33594 3.99821Z" stroke="#464E49" stroke-width="1.83333" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                ICON,
                'child' => Auth::user()->navbars()
                    ->filter(function ($item) {
                        if (
                            !$item->is_moddable ||
                            Str::startsWith($item->route_name, ['company.', 'lse.', 'tsx.', 'fund.', 'otc.', 'mutual-fund.', 'shanghai.', 'japan.', 'hkex.', 'euronext.', 'economics-release', 'create.', 'frankfurt.'])
                        ) {
                            return false;
                        }

                        return true;
                    })
                    ->map(function (Navbar $nav) {
                        return [
                            'title' => $nav->name,
                            'url' => route($nav->route_name, ['ticker' => $this->company->ticker]),
                            'active' => request()->routeIs($nav->route_name)
                        ];
                    })
            ]
        ];
    }
}
